
# fastfft ‚Äî —à–≤–∏–¥–∫–∏–π rFFT-–º–æ–¥—É–ª—å –¥–ª—è MicroPython (RP2040)

`fastfft` ‚Äî –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π C‚Äë–º–æ–¥—É–ª—å –¥–ª—è MicroPython, –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è
—à–≤–∏–¥–∫–æ–≥–æ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è **real FFT (rFFT)** —Ç–∞ **–µ–Ω–µ—Ä–≥—ñ—ó —Å–ø–µ–∫—Ç—Ä–∞** –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ
RP2040 (Raspberry Pi Pico —Ç–∞ —Å—É–º—ñ—Å–Ω—ñ). –ú–æ–¥—É–ª—å –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–π –Ω–∞
—Ä–µ–∞–ª—å–Ω–æ—Ä–µ–º—ñ–Ω–Ω—ñ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏: –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π Python‚Äë–Ω–∞–∫–ª–∞–¥, –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∞–ª–æ–∫–∞—Ü—ñ–π
–ø—ñ–¥ —á–∞—Å –≤–∏–∫–ª–∏–∫—É (static buffers), –¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ—Å—Ç—å —ñ –ø—Ä–æ—Å—Ç–æ—Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó.


---

## üì¶ –û—Å–Ω–æ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

#### –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π FFT —Ä–æ–∑–º—ñ—Ä: **N = 512** –∞–±–æ **N = 1024**  
–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –ø–∞—Ç—á –¥–ª—è —Ñ–∞–π–ª—É `mod_fastfft.c`, —â–æ–± –ø–µ—Ä–µ–π—Ç–∏ –≤—ñ–¥ **N = 512** –¥–æ **N = 1024**:
```diff
- #define FFT_SIZE 512
+ #define FFT_SIZE 1024

- static uint8_t fft_cfg_mem[8192] __attribute__((aligned(8)));
+ static uint8_t fft_cfg_mem[16384] __attribute__((aligned(8)));
```
###  –î–∞–ª—ñ –æ–ø–∏—Å–∞–Ω–Ω—è –ø–æ–¥–∞–Ω–æ –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—É **N = 512**  
- –§—É–Ω–∫—Ü—ñ—è: `fastfft.rfft(buf[, window])` ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î `memoryview('i')` –∑
  –µ–Ω–µ—Ä–≥—ñ—è–º–∏ –±—ñ–Ω—ñ–≤ —è–∫ `int32`
- –í—Ö—ñ–¥: buffer‚Äëprotocol –æ–± º—î–∫—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å **512** `int16` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `array('h')`, `bytearray`, `bytes`, `memoryview`)
- –í–∏—Ö—ñ–¥: `memoryview('i')` –¥–æ–≤–∂–∏–Ω–æ—é **256** (–±—ñ–Ω–∏ 0..255; Nyquist (256) –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è)
- –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è FFT: **kissFFT (float)**; –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ C
- Zero‚Äëcopy: –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è view –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞—Ç–∏—á–Ω–∏–π –±—É—Ñ–µ—Ä (no copy)
- DC (k=0) –ø—Ä–∏–º—É—Å–æ–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ `0` (–∑–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∏–º —Ä—ñ—à–µ–Ω–Ω—è–º)
- –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: –≤—ñ–∫–Ω–æ –ø–µ—Ä–µ–¥ FFT ‚Äî `hann` –∞–±–æ `hamming` (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —è–∫ –¥—Ä—É–≥–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç)
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏—Å–µ–ª: `isfinite` –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ NaN/Inf
- –†–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞ –¥–ª—è –æ–¥–Ω–æ–ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

---

## ‚öôÔ∏è –í–∏–º–æ–≥–∏

- MicroPython –∑—ñ –∑–±—ñ—Ä–∫–æ—é, —â–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î user C‚Äëmodules
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: RP2040 (Raspberry Pi Pico)
- –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ CPU: 133 MHz

---

##  üìå API

### fastfft.rfft(input, window=False)

–û–±—á–∏—Å–ª—é—î rFFT (—Ä–µ–∞–ª—å–Ω–∞ FFT) —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –µ–Ω–µ—Ä–≥—ñ—ó —Å–ø–µ–∫—Ç—Ä–∞.

–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
- `input` ‚Äî –±—É–¥—å‚Äë—è–∫–∏–π buffer –∑ `int16` –¥–æ–≤–∂–∏–Ω–∏ `512`.
  - –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –∞–º–ø–ª—ñ—Ç—É–¥–Ω–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω –¥–ª—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: ¬±10000 (–±–µ–∑–ø–µ—á–Ω–∏–π),
    ¬±15000 (–≤–µ—Ä—Ö–Ω—è "–±–µ–∑–ø–µ—á–Ω–∞" –º–µ–∂–∞). –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–æ–≤–Ω–æ–≥–æ ¬±32767 –º–æ–∂–ª–∏–≤–µ,
    –∞–ª–µ –∑–±—ñ–ª—å—à—É—î —Ä–∏–∑–∏–∫ –∫–ª—ñ–ø—ñ–Ω–≥—É —Ç–∞ –±—ñ–ª—å—à—É –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å —á–∏—Å–ª–æ–≤–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤.
- `window` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –≤–∏–±—ñ—Ä –≤—ñ–∫–Ω–∞:
  - `False` / `None` ‚Äî –±–µ–∑ –≤—ñ–∫–Ω–∞ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
  - `True` ‚Äî –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ `"hann"`
  - `"hann"` ‚Äî Hann (Hanning) window
  - `"hamming"` ‚Äî Hamming window
  - –Ü–Ω–∞–∫—à—ñ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî `TypeError` / `ValueError`.

–ü–æ–≤–µ—Ä—Ç–∞—î:
- `memoryview('i')` –¥–æ–≤–∂–∏–Ω–æ—é `256` (–µ–ª–µ–º–µ–Ω—Ç–∏ —Ç–∏–ø—É `int32`), –¥–µ –∫–æ–∂–µ–Ω
  –µ–ª–µ–º–µ–Ω—Ç ‚Äî –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ –±—ñ–Ω–∞.

–ü–æ–≤–æ–¥–∂–µ–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó:
- –ë–µ–∑ –≤—ñ–∫–Ω–∞:
  - norm = 1.0 / (N * N)
- –ó –≤—ñ–∫–Ω–æ–º (Hann/Hamming) ‚Äî –¥–ª—è –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ (Parseval):
  - norm = 1.0 / (N * sum_w2)
  - sum_w2 = sum_{n=0..N-1} w[n]^2

–ü—Ä–∏–º—ñ—Ç–∫–∏:
- –£ —Ü—å–æ–º—É API `spec[0]` (DC) –ø—Ä–∏–º—É—Å–æ–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `0`.
- Nyquist‚Äë–±—ñ–Ω (k = N/2) –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è; —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω ‚Äî —Ç—Ä–µ–±–∞ –∑–º—ñ–Ω–∏—Ç–∏ API/–∫–æ–¥.

---

## üß†  –¢–µ–æ—Ä–µ—Ç–∏—á–Ω—ñ –≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è

–ù–µ—Ö–∞–π `x[n]` ‚Äî —á–∞—Å–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª –¥–æ–≤–∂–∏–Ω–∏ `N`, –∞ `S[k]` ‚Äî –∑–Ω–∞—á–µ–Ω–Ω—è, —è–∫–µ
–ø–æ–≤–µ—Ä—Ç–∞—î `fastfft.rfft` (–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è –±—ñ–Ω—ñ–≤ 0..N/2-1). –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å
—á–∞—Å–æ–≤–æ—ó —Ç–∞ —á–∞—Å—Ç–æ—Ç–Ω–æ—ó –µ–Ω–µ—Ä–≥—ñ–π (Parseval) –¥–∞—î—Ç—å—Å—è —Ñ–æ—Ä–º—É–ª–æ—é:

Et = sum_{n=0..N-1} x[n]^2

Et = N * ( S[0] + 2 * sum_{k=1..N/2-1} S[k] + S_Nyquist )

–£ –Ω–∞—à–æ–º—É API S[0] = 0, —ñ S_Nyquist –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è; —Ç–æ–º—É —Ç–∏–ø–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:

```python
Et = sum(x[n]*x[n] for n in range(N))
Ef = N * 2 * sum(spec[1:])   # spec == fastfft.rfft(x)
# –û—á—ñ–∫—É—î–º–æ Et ‚âà Ef (—Ä—ñ–∑–Ω–∏—Ü—è –≤—ñ–¥ —á–∏—Å–µ–ª—å–Ω–∏—Ö –ø–æ—Ö–∏–±–æ–∫, DC/Nyquist —ñ —Ç.–¥.)
```

–î–ª—è —á–∏—Å—Ç–æ—ó —Å–∏–Ω—É—Å–æ—ó–¥–∏ `x[n] = A * sin(2œÄ k n / N)` (–∫–æ–ª–∏ —á–∞—Å—Ç–æ—Ç–∞ —Ç–æ—á–Ω–æ –ø–æ—Ç—Ä–∞–ø–ª—è—î –≤ FFT-–±—ñ–Ω):
- –ü—ñ–∫–æ–≤–∞ –µ–Ω–µ—Ä–≥—ñ—è —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–º—É –±—ñ–Ω—ñ –ø—Ä–∏–±–ª–∏–∑–Ω–æ: PeakEnergy ‚âà A^2 / 4 (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –Ω–∞—à–æ—ó –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó).

---  

## ‚öóÔ∏è –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞ –¥–µ—è–∫—ñ —Ç–µ—Å—Ç–∏
#### üß™ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–∏–Ω—É—Å–æ—ó–¥–∏ —Ç–∞ FFT (coherent)  

```python
from array import array
import math
import fastfft

N = 512
k = 32             # –Ω–æ–º–µ—Ä FFT-–±—ñ–Ω–∞
amp = 10_000

buf = array('h', [0] * N)

for n in range(N):
    buf[n] = int(amp * math.sin(2.0 * math.pi * k * n / N))

spec = fastfft.rfft(buf)  # –±–µ–∑ –≤—ñ–∫–Ω–∞

peak_bin = max(range(len(spec)), key=lambda i: spec[i])
print("Peak bin:", peak_bin)
print("Peak energy:", spec[peak_bin])
```

–û—á—ñ–∫—É–≤–∞–Ω–æ:  
```python
Peak bin: 32
Peak energy ‚âà 25_000_000
```

#### ‚úÖ –¢–µ—Å—Ç –Ω–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó —Å–∏–≥–Ω–∞–ª—É –ø—ñ—Å–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è (—Ä—ñ–≤–Ω—ñ—Å—Ç—å –ü–∞—Ä—Å–µ–≤–∞–ª—è)
```python
from array import array
import fastfft
import random


FFT_SIZE = 512
amp = 10_000        # –ø—ñ–∫ —Å–∏–≥–Ω–∞–ª—É (–±–µ–∑ clipping)

buf = array('h', [0]*FFT_SIZE)

# —Ç–µ—Å—Ç–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª –±—ñ–ª–∏–π —à—É–º
for i in range(FFT_SIZE):
    buf[i] = random.randint(-amp, amp)

# –µ–Ω–µ—Ä–≥—ñ—è —É —á–∞—Å—ñ
Et = sum(x*x for x in buf)

spec = fastfft.rfft(buf)

# –µ–Ω–µ—Ä–≥—ñ—è —É —á–∞—Å—Ç–æ—Ç—ñ
Ef = 2 * sum(spec[1:]) * FFT_SIZE

print(f'–ü–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ ~–æ–¥–Ω–∞–∫–æ–≤—ñ: {Et} ~= {Ef}') # –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ ~–æ–¥–Ω–∞–∫–æ–≤—ñ
```
#### :seedling: dBFS —Ç–∞ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –≤ —Å–º—É–∑—ñ —á–∞—Å—Ç–æ—Ç

–û–±—á–∏—Å–ª–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è —É dBFS (–¥–ë –ø–æ–≤–Ω–æ—ó —à–∫–∞–ª–∏) –¥–ª—è —Å–º—É–≥–∏ –±—ñ–Ω—ñ–≤ `i..j`:  
–ü–æ–∑–Ω–∞—á–µ–Ω–Ω—è:
- `spec` ‚Äî –ø–æ–≤–µ—Ä–Ω—É—Ç–∏–π –º–∞—Å–∏–≤ S[k]
- `N` ‚Äî FFT_SIZE (512)
- `FS_RMS2 = (32767**2) / 2` ‚Äî –ø–æ–≤–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω–∞ RMS‚Äë–ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –¥–ª—è —Å–∏–Ω—É—Å–∞ –∞–º–ø–ª—ñ—Ç—É–¥–∏ 32767

–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (RMS^2) —Å–º—É–≥–∏:
- P_band = 2 * sum(spec[i:j+1])

–¢–æ–¥—ñ
- dBFS = 10 * log10( P_band / FS_RMS2 )  

```python
from array import array
import math
import fastfft
import random


FFT_SIZE = 512
amp = 10_000        # –ø—ñ–∫ —Å–∏–≥–Ω–∞–ª—É (–±–µ–∑ clipping)

buf = array('h', [0]*FFT_SIZE)

# —Ç–µ—Å—Ç–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª –±—ñ–ª–∏–π —à—É–º
for i in range(FFT_SIZE):
    buf[i] = random.randint(-amp, amp)

spec = fastfft.rfft(buf)

# –û–ø–æ—Ä–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –ø–æ–≤–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω–æ–≥–æ —Å–∏–Ω—É—Å–∞ (Standard AES17 Reference)
FS_RMS2 = (32767**2) / 2

# –∑–Ω–∞—á–µ–Ω–Ω—è dBFS –¥–ª—è —Å–º—É–≥–∏ —á–∞—Å—Ç–æ—Ç
def band_dbfs(spec, i, j):
    
    e = 0
    for k in range(i, j):
        e += spec[k]
    
    if e <= 0:
        return -120
    
    return 10 * math.log10((2 * e) / FS_RMS2)

pin_1, pin_2 = 4, 50 # –∑–Ω–∞—á–µ–Ω–Ω—è –¥—ñ–∞–ø–∞–∑–æ–Ω—É –ø—ñ–Ω—ñ–≤ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
dbfs_for_band = band_dbfs(spec, pin_1, pin_2)
print(dbfs_for_band)
```
#### üìä –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤—ñ–∫–æ–Ω raw/Hann/Hamming
```python
# test_windows.py
from array import array
import math
import fastfft
import time

FFT_SIZE = 512

def make_sine(f, amp=10000):
    a = array('h', [0]*FFT_SIZE)
    for n in range(FFT_SIZE):
        a[n] = int(amp * math.sin(2*math.pi * f * n / FFT_SIZE))
    return a

def analyze(buf, window):
    mv = fastfft.rfft(buf, window)
    energies = list(mv)
    peak_idx = max(range(1, len(energies)), key=lambda i: energies[i])  # ignore DC
    peak = energies[peak_idx]
    # measure few offsets in dB
    def db(rel):
        if rel <= 0: return -999.0
        return 20*math.log10(rel)
    offsets = [1,2,3,5,10,20,50]
    print("window:", window, "peak_idx:", peak_idx, "peak:", peak)
    for off in offsets:
        idx = peak_idx + off
        if idx < len(energies):
            print("  +{}: {:d}  ({:+.2f} dB)".format(off, energies[idx], db(energies[idx]/peak)))
    print()

# Non-coherent tone (k + 0.3)
f = 20.3
buf = make_sine(f)
print("Non-coherent tone f=", f)
analyze(buf, False)
analyze(buf, True)       # Hann
analyze(buf, "hamming")  # Hamming
```

---  

## ‚è± –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (RP2040 @133 MHz)

- –ü—Ä–∏–∫–ª–∞–¥–Ω–µ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è: –ø–æ–≤–Ω–∏–π –≤–∏–∫–ª–∏–∫ `rfft()` ‚âà **12 ms** (–±–µ–∑ –≤—ñ–∫–Ω–∞)
- –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–∫–Ω–∞ —É C (–≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ) –¥–∞—î –ø—Ä–∏–±–ª–∏–∑–Ω–æ +0.5 ms –Ω–∞–∫–ª–∞–¥—É
- –ú–µ—Ç–æ–¥–∏ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è: `time.ticks_us()` –∞–±–æ `time.ticks_ms()` —É MicroPython  
–Ø–∫ –≤–∏–º—ñ—Ä—é–≤–∞–ª–æ—Å—å: 
```python
from array import array
import fastfft
import time

buf = array('h', [0] * 512)

# –ø—Ä–æ–≥—Ä—ñ–≤ (–≤–∞–∂–ª–∏–≤–æ!)
for _ in range(5):
    fastfft.rfft(buf)

t0 = time.ticks_us()
s = fastfft.rfft(buf)
t1 = time.ticks_us()

dt = time.ticks_diff(t1, t0)
print("FFT time:", dt, "us")
```
##### –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π FFT –Ω–∞ RP2040 (N = 512) :chart_with_upwards_trend:
| –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è                                     | –ß–∞—Å (N=512, RP2040)   |
| ---------------------------------------------- | --------------------- |
| Pure Python radix-2 FFT (iterative)            | ~128 ms          |
| ulab ```np.fft.fft() ```                       | ~26 ms           |
| –ú–æ–¥—É–ª—å fastfft (KissFFT) ```fastfft.rfft() ``` | ~12 ms           |

---  
## üîí –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è

- –ú–æ–¥—É–ª—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—Ç–∞—Ç–∏—á–Ω—ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –±—É—Ñ–µ—Ä–∏ (–±–µ–∑ –≤–∏–¥—ñ–ª–µ–Ω—å –ø—ñ–¥ —á–∞—Å –≤–∏–∫–ª–∏–∫—É rfft) ‚Äî —Ü–µ –ø—ñ–¥–≤–∏—â—É—î –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ—Å—Ç—å –Ω–∞ –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.
- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è FFT‚Äë–ø–ª–∞–Ω—É –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑; –º–æ–¥—É–ª—å **–Ω–µ** –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π. –Ø–∫—â–æ –≤–∏–∫–ª–∏–∫–∏ –º–æ–∂–ª–∏–≤—ñ –∑ —Ä—ñ–∑–Ω–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤, –¥–æ–¥–∞–π—Ç–µ –∑–æ–≤–Ω—ñ—à–Ω—é —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é.
- –ü–æ–≤–µ—Ä–Ω—É—Ç–∏–π `memoryview` –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞—Ç–∏—á–Ω–∏–π –±—É—Ñ–µ—Ä. –ù–µ –º–æ–¥–∏—Ñ—ñ–∫—É–π—Ç–µ —Ü–µ–π –±—É—Ñ–µ—Ä –∑ C/—ñ–Ω—à–æ–≥–æ –∫–æ–¥—É —ñ –Ω–µ –æ—á—ñ–∫—É–π—Ç–µ, —â–æ –π–æ–≥–æ –≤–º—ñ—Å—Ç –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤.
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `isfinite` —Ç–∞ –æ–±–Ω—É–ª–µ–Ω–Ω—è –±—ñ–Ω—ñ–≤ –∑ NaN/Inf –∑–∞–ø–æ–±—ñ–≥–∞—î –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ–π –ø–æ–≤–µ–¥—ñ–Ω—Ü—ñ.
- –û–±—Ä–æ–±–∫–∞ –ø–æ–≤–Ω–æ–≥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É `int16` –º–æ–∂–ª–∏–≤–∞, –∞–ª–µ –≤–∏–º–∞–≥–∞—î —É–≤–∞–≥–∏: –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –≤–µ–ª–∏–∫–∏–º–∏ –∞–º–ø–ª—ñ—Ç—É–¥–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –Ω–∞ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–∞ —á–∏—Å–µ–ª—å–Ω—ñ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∏.

---  
---

## üîß Building MicroPython with `fastfft` module

---

–¶–µ–π —Ä–æ–∑–¥—ñ–ª –æ–ø–∏—Å—É—î, —è–∫ **–≤–º–æ–Ω—Ç—É–≤–∞—Ç–∏ –º–æ–¥—É–ª—å `fastfft` —É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –ø—Ä–æ—à–∏–≤–∫—É MicroPython**
—Ç–∞ –∑—ñ–±—Ä–∞—Ç–∏ –≥–æ—Ç–æ–≤–∏–π —Ñ–∞–π–ª –ø—Ä–æ—à–∏–≤–∫–∏ `.uf2` –¥–ª—è RP2040 (Raspberry Pi Pico).

–ú–æ–¥—É–ª—å –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è —è–∫ **C user module** —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω—ñ–∑–º `usermods`.

---

### üìã –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

–û—á—ñ–∫—É—î—Ç—å—Å—è, —â–æ —É –≤–∞—Å –≤–∂–µ —î:

- –∫–ª–æ–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é **MicroPython**
- –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π **Pico SDK**
- —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –∑–±—ñ—Ä–∫–∏ (`cmake`, `make`)
- –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä `arm-none-eabi-gcc` –¥–æ—Å—Ç—É–ø–Ω–∏–π —É `PATH`

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–∞:

```bash
arm-none-eabi-gcc --version
```
### üìÅ –†–æ–∑–º—ñ—â–µ–Ω–Ω—è –º–æ–¥—É–ª—è —Ç–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏

–°–∫–æ–ø—ñ—é–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ –º–æ–¥—É–ª—è fastfft —Ä–∞–∑–æ–º –∑ —É—Å—ñ–º–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏ —É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é usermods.  
–§–∞–π–ª–∏ _kiss_fft_guts.h, kiss_fft.c, kiss_fft.h, kiss_fft_log.h, kiss_fftr.c, kiss_fftr.h –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∑—è—Ç–∏ —ñ–∑ —Ä–µ–ø–æ–∑–∏—Ç–∞—Ä—ñ—è [kissFFT](https://github.com/mborgerding/kissfft)  

–ö–æ—Ä–µ–∫—Ç–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: 
```bash
micropython/usermods
‚îú‚îÄ‚îÄ fastfft
‚îÇ   ‚îú‚îÄ‚îÄ mod_fastfft.c
‚îÇ   ‚îú‚îÄ‚îÄ _kiss_fft_guts.h
‚îÇ   ‚îú‚îÄ‚îÄ kiss_fft.c
‚îÇ   ‚îú‚îÄ‚îÄ kiss_fft.h
‚îÇ   ‚îú‚îÄ‚îÄ kiss_fft_log.h
‚îÇ   ‚îú‚îÄ‚îÄ kiss_fftr.c
‚îÇ   ‚îú‚îÄ‚îÄ kiss_fftr.h
‚îÇ   ‚îî‚îÄ‚îÄ micropython.cmake
‚îî‚îÄ‚îÄ micropython.cmake
```
### üß© –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –º–æ–¥—É–ª—è

–§–∞–π–ª:  
```bash
micropython/usermods/micropython.cmake
```
–ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏:  
```bash
include(${CMAKE_CURRENT_LIST_DIR}/fastfft/micropython.cmake) 
```
–¶–µ –ø—ñ–¥–∫–ª—é—á–∞—î –º–æ–¥—É–ª—å fastfft –¥–æ —Å–∏—Å—Ç–µ–º–∏ –∑–±—ñ—Ä–∫–∏ MicroPython.  
### üß± –û–ø–∏—Å –º–æ–¥—É–ª—è  
–§–∞–π–ª:  
```cmake
micropython/usermods/fastfft/micropython.cmake
```
–ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏:
```cmake
set(FASTFFT_MOD_DIR ${CMAKE_CURRENT_LIST_DIR})

list(APPEND MICROPY_SOURCE_EXTMOD
    ${FASTFFT_MOD_DIR}/mod_fastfft.c
    ${FASTFFT_MOD_DIR}/kiss_fft.c
    ${FASTFFT_MOD_DIR}/kiss_fftr.c
)

list(APPEND MICROPY_INC_EXTMOD
    ${FASTFFT_MOD_DIR}
) 
```
### üèóÔ∏è –ó–±—ñ—Ä–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏  
```bash
cd ~/micropython/ports/rp2
rm -rf build
mkdir build
cd build

cmake .. \
  -DPICO_BOARD=pico \
  -DUSER_C_MODULES=$HOME/micropython/usermods

make -j4 | tee build.log
```
–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –∑–±—ñ—Ä–∫–∏ –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ñ–∞–π–ª:  
```bash
firmware.uf2
```
### ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ—Å–ª—è –ø—Ä–æ—à–∏–≤–∫–∏  
```python
import fastfft
dir(fastfft)
```
---

## üìÑ Credits and License
- **fastfft module**: Licensed under MIT.
- **kissFFT**: This project uses the [kissFFT](https://github.com/mborgerding/kissfft) library by Mark Borgerding, licensed under the **BSD 3-Clause License**.
---  
